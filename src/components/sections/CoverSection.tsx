'use client'

import { useState, useEffect } from 'react'
import { useScrollAnimation } from '@/hooks/useScrollAnimation'
import ScriptWritePath from '@/components/ScriptWritePath'

export default function CoverSection() {
  const [imageUrl, setImageUrl] = useState<string>('')
  const [isLoading, setIsLoading] = useState(true)
  const photoAnimation = useScrollAnimation({ threshold: 0.2, animationDelay: 400 })

  useEffect(() => {
    const fetchCoverImage = async () => {
      try {
        const response = await fetch('/api/cover-image')
        const data = await response.json()
        if (data.success && data.data?.url) {
          setImageUrl(data.data.url)
        }
      } catch (error) {
        console.error('Error fetching cover image:', error)
      } finally {
        setIsLoading(false)
      }
    }

    fetchCoverImage()
  }, [])


  const hasImage = Boolean(imageUrl)
  const overlayTextShadow = { textShadow: '0 12px 28px rgba(0,0,0,0.45)' }
  const beigeColor = '#F5F5DC' // 연한 베이지색 (beige)

  // 제공된 SVG에서 추출한 실제 필기체 path 데이터
  // 원본 SVG viewBox: "0 0 900 1600"
  // 상단 부분 (y: 200-300) = "Fall in Love"
  // 하단 부분 (y: 1200-1600) = "With You"
  
  // "Fall in Love" - 상단 부분의 주요 path들
  const fallInLovePath = "M419.6,285.6c15.8,22.8,37.4,12.6,44.7-10.4c4.7-13.5,4.3-28.3,4.1-42.9c8.3,6.7,4.2,32.6,11.5,38.4c5.6-2.2,1.8-10.3,2.5-14.8c0-7.4,1-14,3.5-20.9c0.8-4.2,13.6-26.4,15.9-13.7c-1,12-5.3,27.4-5.2,39.9c-1.3,11.8,8.2,14.7,9.7,3.6c-10.4,12.5-7.4-8.4-5.9-14.9c2-8.8,7.7-18,7.7-27.3c0.6-9-9.2-9-14.1-4.5c-8.6,8.2-11.9,20.8-14,32.1c-2.3-5.6-3.7-18.9-11.7-18.8c-0.8-13.4-2-29.1-8.2-40.6c-6.9-13.5-19.8-11.1-22.1,3.9c-2.6,9.4-1.7,43.9,14.5,34.7c1-2-1.9,0.4-2.8,0.1c-9-4.1-8.9-19.4-9.6-28.4c0.6-30,16.6-17,20.1,4c3.8,16.3,4.1,34.9,2.7,51.7c-0.6,38.1-28.1,59.5-45.2,14.9c-4.2-12.2-3.4-26.4,2.5-37.6C408.5,245.7,409.4,271.8,419.6,285.6z M527.1,284.7c5.7,3.3,10.8-4.2,11.6-10.5c16.3-6.8,28.9-12.1,46.9-11.5c9.5,0.1,12,1.9,16.3,9.7c5-25.7-52.1-11.4-63.1-2.7c1.7-9.1,5-17.2,8.5-25.6c23.8,4.9,45.1-17.3,57.1-35.5c21.6-32,1.3-48-25.9-22c-14.4,14.8-25.4,35.5-34.1,53.7c-7.9-4.3-3.6-12.9-6.7-14.4c-4.5,4.5,0.1,15.3,5.7,16.7c-4.6,9.1-7.5,19.8-9.7,29.7C529.7,275.7,523.7,280.2,527.1,284.7z M554,231.2c10.2-17.8,22.9-38.5,39.9-50.4c23.6-13.3,16.1,13.9,7.5,25.7c-11.3,17.1-30.3,39.1-52.9,35.5C549.8,239.1,551.6,235.5,554,231.2z M607.8,225.7c-4.2,9.9-2.9,20.2-4.7,30.5c-1,10.4,8,24.1,18.9,16.1c9.4-8.4,13-21.9,12.3-34.1c16.3-6.1,7.9,31.9,11.8,39.7c5.7,3.7,5.2-6.2,6.3-10.4c1.7-9.1,5.5-19.1,11.6-26.6c-3.1,14.9,4,41.5,21,26c3.4-3.3,7.4-9.2,8.9-15.2c-0.2-2.2-2.3-0.8-2.9,1.1c-7.1,17.6-23.3,23.5-23.3-0.1c0-5.5,1.4-15.2,4-18.5c2.6-4.1,6.9-4.3,7.1,0.5c0.8,7.2-11.9,14.7-9.1,15.2c6.7-1.5,12.5-10.6,12.8-17.2c0.2-6.8-7.2-9-12-4.7c-9.2,10.8-17.6,25.9-22.2,39.6c0.9-9.2,2.5-43.1-14.1-31.5C633.2,220.8,616,206.5,607.8,225.7z M618.5,219.9c10.1-0.3,10.5,13,11.4,20.4c-1.6,1.4-2.6,4.9,0.1,2.4c2.4,25.6-22.7,45.7-22.2,9.3c3.6,4.5,10,8.8,15.7,5.9c0.6-0.2,3.2-1.6,2.1-2.1c-6.9,3.1-18.2-0.7-16.8-9.1c1.8-5.6,4-15.3,10.4-17.3c-2.9-4.8-9.6,6.5-10.8,8.9C606.8,232,611.3,220.9,618.5,219.9z M324.1,234.3c-17.7,27.4-7.9,54.7,12.5,13.9c-1,8.5,4.3,23.1,13.8,11.2c1.3,8.5,8.3,34.4,18.4,31.2c-14.2-6.6-15.4-45.4-16-60.4c0.2-12.6,1.6-27.4,8.7-37.7c5.2-7.8,10.1-7,10,3.7c1.1,16.1-6.9,32.8-12.8,48.7c4.1-5.4,6.8-12.6,9.8-18.7c-1,20.2,0.1,44.9,12.6,61.1c1.3,1.9,5.5,5.7,7.5,3.3c-16.4-7.7-17.8-63.8-14.1-80.7c1.6-7.7,5.7-20.6,13.1-22.7c10.6,6.4-1.9,43-8.4,54.3c-3.2,9.3,4-4.3,4.7-6.1c6.8-12.8,12.4-27.9,12.8-40.5c0.5-16.4-14.2-11.3-19.7-0.6c-0.9-20.9-20.4-5-23.2,7.4c-6,17-6.3,37.3-3.6,55.3c-2.5-0.4-4.2,5.5-5.8,4.7c-5-4.6-0.4-14.1-0.8-20.3c0.4-3.4-3.8-5.2-5.5-1.5c-1.1,4.2-16.5,37.4-18.7,20.9c-0.1-10.2,9.5-45.2,21.5-24.8C347.1,229.1,335,215.2,324.1,234.3z M238.6,222.4c1.4,2,3.5,0.4,1.6-1.3c-13.2-25.9,23.3-37.3,43.6-36.5c6.7,12.8,9.7,29.4,10.1,44.4c-4.2,1.2-26.3,8.6-18.1,14.4c5.8-4.1,11.5-8.6,18.1-11.2c-0.5,18.4,0.1,40.9-13.1,54.4c-17.6,14.6-32.1-16.2-31.2-31.5c-0.3-6.2,2.2-12.7,4.5-17.6c-5.5,3.9-6.9,14.8-7.2,21.6c-1.6,18.4,18.3,43.8,36.1,27.7c15.3-13.6,15.7-36.7,15.3-56.4c5.3-2.4,13.9-1.3,18.7-3.1c-5.5-2.3-12.8-0.1-18.7,0.5c-0.8-14.3-1.9-30.6-8.1-43.3c16.5,0.9,37.9,3.5,44.9,19.1c1.3-18.7-33.9-23.5-48.1-23.9c-1.2-3.7-17.1-8.9-14.7-3.5c2.9,1.1,5.6,0.2,8,3.5C258.7,179.5,222.4,195.9,238.6,222.4z"
  const fallInLoveViewBox = "0 0 900 400"
  
  // "With You" - 하단 부분의 주요 path들 (y: 1200-1600)
  const withYouPath = "M848.5,1287.2c-3.6,0.7-3.3,2.8-7,6.7c-14.1,14.2-12.1-19.3-9.8-28.6c1.2-9.2,6.1-22.5-5.4-23.2c-6.2,1.2-11.3,21.1-15.9,28.6c-3.6,8.4-24,48.5-32.4,32.7c-3.6-20.3,3.7-40,7-60c1.9-12.4,4-25.8,0-35.9c-2.8-6.7-10.8-6.7-14.6-0.3c-12.8,29.8,19.5-31.2,7.9,29.2c-2,20.1-18.9,60.2-11.1,75.9c15.9,17.9,47.7-32.1,51.1-45.7c0.8,11.5,1.5,35.3,17.2,36.5C841.2,1304.4,855.6,1291.1,848.5,1287.2z M233.3,1285.3c12.7,24.2,38.9,46.6,58.4,15.2c21.5-33.7,24.5-98.9,22.9-141.7c4.2,7.2,7.9,12.2,11.1,14.9c4.4,2.9,15.6,12.4,19.4,3.2c0-0.6-0.2-1.1-0.6-1.3c-3-1.1-6-4-9.2-8.9c-11.3-17.7-16.4-40.4-27-57.8c-9.2-11.9-10.9,7.8-8.9,14.6c14,45.5,10.7,130.6-11.8,172.8c-22.1,32.5-43.6-16.3-54.6-41.9c-8.2-20.1-13.4-43.5-17.8-65.4c-3.3-9.5-4.8-44.1-14.6-43.2c-15.1,3.2-12.3,35.7-6.4,46.1c-6.8,33.1-16.6,74.4-32.1,104.5c-46.5,90.6-62,27.1-55-38.4c3.5-51.3,16.1-111.8,5.1-161.7c-9.4-36.3-44.8-19.7-43.2,10.2c1.2,12.4,10.4-23.5,22.6-22.6c26.4,2,0.7,169.7,0.6,196.3c-4.4,29,0.2,99.3,40.7,66.1c38.8-36.3,59.9-95.1,72.7-146.8C211.1,1226.4,219.1,1260.5,233.3,1285.3z M385.4,1214.2c-7.9,2.1-20.2,3.2-21.3,12.7c0,3.6,1.6,5.4,4.8,5.4c6.7-0.1,15.7-6.7,21.9-7.9c-6.2,17.5-9.3,36.4-12.4,55.6c-6.3,16.9-45.5,71.2-45.7,24.1c-0.2-20.8,5.1-30.4,13.7-48.6c3.6-8.3,18.1-27.7,4.1-32.4c-17.5,4.8-27,58.5-27,76.2c0.5,46.5,41.2,25.8,53.6-3.1c-0.9,19.7,0.7,40.5,8.3,58.7c2.6,6.1,8.4,17.9,14.3,14c-27.7-27.3-11.3-95-2.5-129.9c2.1-7.2,3.8-11.8,5.1-13.7c6.4-6.6,21.1-7.8,28.7-9.8c-4.3,16.9-24.1,90.5-7.8,97.8c3.1,0.8,3.5-8.4,4.1-9.5c3-15.4,17-36.7,28.3-49.2c2.8-3,24.3-28,25.7-16.5c-1.9,23.9-73,128.5-28,136.6c4.6,0.8,21.3-7.7,16.8-12.4c-16.9,14.8-22.1,3.1-22.2-14.9c0-35.5,27.1-63.1,41.9-93.1c12.1-22.1-0.2-34.2-20.3-19.4c-20.3,16.6-37.2,40.6-45.7,64.8h-0.3c1.4-28.9,8.5-58.5,17.9-85.4c13.3,0.4,11.1-2.6,1.8-5.1c7.3-19.8,17.3-40.3,25-56.5c3-5.9,4.4-9.3,4.4-10.2c-1.4-6.9-8.7-8.3-12.7-0.6c-12.2,18.8-19.5,43-26.9,66.2c-8-0.4-16.3,0.1-23.9,1.4c7.4-20.6,24.4-40,33.4-59.1c8.4-19-11.5-12.8-17.2-1c-12.5,17.9-22.3,41.6-29.9,61.6C393.9,1212.1,390.5,1213.1,385.4,1214.2z M752.1,1295.8c31.5-69.5-24.5-142.8-54.3-82.3c-6.3,15.5-9.4,33.9-7.3,50.2c-2.7,8-4.5,19-3.6,28.1c-4.9,0.6-9.8,1.3-14.6,2.1c3.1-47.9,0.7-104.9-14.6-149.3c-2.7-8.5-18.5-5.6-16.5,4.5c0,0,2.9,9.2,2.9,9.2c-7.2,32.6-17.2,75.7-32.4,105.5c-7.8,13.4-32.8,65-48.9,37.2c-9.2-19-8.5-49.8-5.7-74c2.6-25.5,6.6-54.1,8.9-80.4c1.6-29.2,9.8-98.5-26-104.2c-14.5,0.8-23.3,20.9-20.6,33.7c0.7,4.4,10.4-18.6,13.7-20.3c19.7-19.2,19.8,24.7,20,40c0.4,60.4-12.6,127.3-12.1,187.1c2.3,31.4,19,55.7,45.4,28.6c33.1-35.3,51.5-89.5,61.9-138.8c10.5,39.7,18.7,82.5,16.5,123.6c-53,11.4-106.3,39.9-136.6,81.3c-12.9,19.4-18.5,41.1-1.9,56.2c13.6,11.3,33.4,10.1,51.1,3.8c54.9-21.2,83.9-78.7,94-137.2c5.4-1.4,10.8-2.4,16.2-3.2c1.8,22.9,22.4,43.8,44.3,27.7C740.4,1317.9,747.8,1305.4,752.1,1295.8z M650,1351.4c-18.8,39.1-56.1,81.3-101,86.1c-32.5-0.8-24.1-39.9-8.3-57.5c28.9-37.5,78.1-65,123.2-77.2C661.8,1319.7,657.2,1335.9,650,1351.4z M697.1,1281.2c0-1.7,0.1-3.4,0.3-5.1c4.5,5,9.6,10.2,15.8,13.4c-5.4,0.1-10.8,0.4-16,1C697.1,1287.5,697.1,1284.2,697.1,1281.2z M718.1,1323.1c-12.2-0.4-19.2-14.6-20.4-27.5c7.1-1.6,16.5,0.2,22.2-3.8c10.4,3.8,27.8-8.6,17.9-6.1c-8.5,2.5-21.1,2.9-27.6-2.2c-8.1-5.7-13.2-14.8-9.2-23.2c3.8-12.3,9.8-34.2,23.8-38.1c-5.9-11.9-23.6,15.9-25.7,21.3c-5.8-19,17.8-59.3,38.8-38.4C758.4,1229.4,755.9,1317.1,718.1,1323.1z"
  const withYouViewBox = "0 1200 900 400"

  return (
    <section className="w-full min-h-screen">
      <div className="relative w-full min-h-screen flex flex-col">
        <div className="absolute inset-0">
          {isLoading ? (
            <div className="w-full h-full bg-gray-200 animate-pulse flex items-center justify-center">
              <svg className="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
            </div>
          ) : hasImage ? (
            <img src={imageUrl} alt="Wedding Cover" className="w-full h-full object-cover" />
          ) : (
            <div className="w-full h-full bg-gray-100 flex flex-col items-center justify-center gap-4 border border-dashed border-gray-200 text-center px-6">
              <svg className="w-10 h-10 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={1.5}
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              <p className="text-sm text-gray-500">커버 사진을 준비 중입니다.</p>
            </div>
          )}
          <div className="absolute inset-0 bg-gradient-to-b from-black/45 via-transparent to-black/65" />
        </div>

        <div
          ref={photoAnimation.ref}
          className={`relative z-10 flex flex-col flex-1 px-6 md:px-12 py-10 text-white transition-opacity duration-700 ${photoAnimation.animationClass}`}
        >
          {/* 상단 좌/우 */}
          <div className="absolute top-8 left-8 text-xl md:text-3xl font-heading opacity-0 animate-fade-in" style={{ ...overlayTextShadow, color: beigeColor, animationDelay: '0ms', animationFillMode: 'forwards' }}>
          임희근
          </div>
          <div className="absolute top-8 right-8 text-xl md:text-3xl font-heading opacity-0 animate-fade-in" style={{ ...overlayTextShadow, color: beigeColor, animationDelay: '0ms', animationFillMode: 'forwards' }}>
            이은혜
          </div>

          {/* 가운데 "Fall in Love" 필기체 */}
          <div className="absolute top-16 left-1/2 -translate-x-1/2 w-[80%] max-w-[480px]">
            <ScriptWritePath
              pathData={fallInLovePath}
              viewBox={fallInLoveViewBox}
              className="w-full h-[110px] md:h-[150px]"
              color={beigeColor}
              strokeWidth={1.5}
              durationMs={2000}
              delayMs={800}
            />
          </div>

          {/* 하단 "With You" 필기체 */}
          <div className="absolute bottom-7 left-1/2 -translate-x-1/2 w-[90%] max-w-[580px]">
            <ScriptWritePath
              pathData={withYouPath}
              viewBox={withYouViewBox}
              className="w-full h-[150px] md:h-[210px]"
              color={beigeColor}
              strokeWidth={2}
              durationMs={2000}
              delayMs={1500}
            />
          </div>

          {/* 기존 날짜/장소는 필요하면 위 사진처럼 숨기거나, 아주 작게 하단에 */}
          <div className="absolute bottom-8 left-1/2 -translate-x-1/2 text-center" style={{ ...overlayTextShadow, color: beigeColor }}>
            <p className="text-xs md:text-sm tracking-[0.35em] font-heading uppercase opacity-80 whitespace-nowrap">
              June 13, 2026 · 1:00 PM
            </p>
            <p className="text-xs md:text-sm tracking-[0.35em] font-heading uppercase opacity-80 mt-1">
              정동제일교회
            </p>
          </div>
        </div>
      </div>
    </section>
  )
}
